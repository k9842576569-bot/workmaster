<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Work Master</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.card{max-width:420px;margin:auto;background:#fff;padding:20px;border-radius:8px;margin-bottom:20px}
input,select,button{width:100%;padding:10px;margin:6px 0}
button{background:#007bff;color:#fff;border:none}
.hidden{display:none}
.error{color:red;text-align:center}
.success{color:green;text-align:center}
.box{background:#eef;padding:10px;border-radius:6px;margin-top:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h3>Login</h3>
  <input id="loginMobile" placeholder="Mobile Number">
  <input id="loginPassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <div id="loginMsg" class="error"></div>
</div>

<!-- APP -->
<div class="card hidden" id="appCard">
  <h3>Attendance</h3>
  <div id="welcome"></div>

  <label>In Time</label>
  <input type="time" id="inTime">
  <select id="inMeridiem">
    <option>AM</option>
    <option>PM</option>
  </select>

  <label>Out Time</label>
  <input type="time" id="outTime">
  <select id="outMeridiem">
    <option>AM</option>
    <option>PM</option>
  </select>

  <button onclick="saveAttendance()">Save Attendance</button>
  <div id="saveMsg" class="success"></div>
</div>

<!-- BRANCH SEARCH -->
<div class="card hidden" id="branchCard">
  <h3>Branch Search</h3>

  <input id="branchSearch" placeholder="Enter Branch Code or Name">
  <button onclick="searchBranch()">Search</button>

  <div id="branchResult" class="box hidden"></div>
</div>

<script>
let staffData = {};
let branchData = {};
let currentUser = null;

/* LOAD STAFF */
fetch("./staff_master.json")
.then(r => r.json())
.then(d => staffData = d);

/* LOAD BRANCH */
fetch("./branch_master.json")
.then(r => r.json())
.then(d => branchData = d);

/* LOGIN */
function login(){
  const mobile = loginMobile.value.trim();
  const pwd = loginPassword.value.trim();
  loginMsg.textContent = "";

  for(let k in staffData){
    let u = staffData[k];
    if(u.Mobile === mobile && u.Password === pwd){
      currentUser = u;

      loginCard.classList.add("hidden");
      appCard.classList.remove("hidden");
      branchCard.classList.remove("hidden");

      welcome.innerHTML = "Welcome <b>" + u.Name + "</b>";
      return;
    }
  }
  loginMsg.textContent = "Invalid Login";
}

/* SAVE ATTENDANCE */
function saveAttendance(){
  if(!inTime.value || !outTime.value){
    alert("Select time");
    return;
  }

  const record = {
    user: currentUser.Name,
    inTime: inTime.value + " " + inMeridiem.value,
    outTime: outTime.value + " " + outMeridiem.value,
    date: new Date().toLocaleDateString()
  };

  localStorage.setItem("attendance", JSON.stringify(record));
  saveMsg.textContent = "Attendance Saved";
}

/* BRANCH SEARCH */
function searchBranch(){
  const q = branchSearch.value.trim().toUpperCase();
  const box = branchResult;
  box.classList.add("hidden");

  if(!q) return;

  /* Search by CODE */
  if(branchData[q]){
    showBranch(q, branchData[q]);
    return;
  }

  /* Search by NAME */
  for(let code in branchData){
    let b = branchData[code];
    if(b.BANCH_NAME.includes(q)){
      showBranch(code, b);
      return;
    }
  }

  box.innerHTML = "No branch found";
  box.classList.remove("hidden");
}

function showBranch(code, b){
  branchResult.innerHTML =
    "<b>Branch Code:</b> " + code + "<br>" +
    "<b>Branch Name:</b> " + b.BANCH_NAME + "<br>" +
    "<b>District:</b> " + b.DISTRICT + "<br>" +
    "<b>Pincode:</b> " + b.PINCODE;

  branchResult.classList.remove("hidden");
}
</script>

</body>
</html>
