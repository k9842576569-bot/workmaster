<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Work Master — 12-hour Time (LOGIN FIXED)</title>

<style>
  :root{--accent:#007bff;--ok:#2e8b57;--err:#d9534f}
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;padding:12px}
  .card{max-width:1000px;margin:12px auto;background:#fff;border-radius:8px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  h2{margin:6px 0 12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input,select,textarea,button{font-size:15px;padding:8px;border:1px solid #d0d7de;border-radius:6px}
  label{font-weight:600;margin-top:6px;display:block}
  .flex-1{flex:1 1 220px}
  .btn{background:var(--accent);color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer}
  .btn-secondary{background:#6c757d}
  .btn-danger{background:var(--err)}
  .btn-green{background:var(--ok)}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
  th,td{border:1px solid #e2e8f0;padding:8px}
  th{background:#f1f5f9}
  .small{font-size:13px;color:#666}
  .hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h2>Staff Login</h2>
  <div class="row">
    <div class="flex-1"><input id="loginMobile" placeholder="Mobile number"></div>
    <div class="flex-1"><input id="loginPassword" type="password" placeholder="Password"></div>
  </div>
  <div style="margin-top:10px">
    <button class="btn" onclick="login()">Login</button>
    <span class="small">Demo: 9876543210 / admin123</span>
  </div>
  <p id="loginMsg" class="small" style="color:var(--err)"></p>
</div>

<!-- APP -->
<div class="card hidden" id="appCard">
  <h2>Work Master</h2>
  <div id="userInfo" class="small"></div>

  <label>Date</label>
  <input type="date" id="workDate">

  <label>Branch Code</label>
  <div class="row">
    <input id="branchCode" class="flex-1">
    <button class="btn btn-green" onclick="searchBranch()">SEARCH</button>
  </div>

  <input id="branchName" placeholder="Branch Name" readonly>

  <!-- Time -->
  <label>In Time</label>
  <div class="row">
    <input id="inHour" type="number" min="1" max="12" placeholder="HH">
    <input id="inMinute" type="number" min="0" max="59" placeholder="MM">
    <select id="inAmPm"><option>AM</option><option>PM</option></select>
  </div>

  <label>Out Time</label>
  <div class="row">
    <input id="outHour" type="number" min="1" max="12" placeholder="HH">
    <input id="outMinute" type="number" min="0" max="59" placeholder="MM">
    <select id="outAmPm"><option>AM</option><option>PM</option></select>
  </div>

  <label>Remarks</label>
  <textarea id="remarks"></textarea>

  <button class="btn" onclick="save()">Save</button>
  <button class="btn btn-danger" onclick="logout()">Logout</button>

  <table>
    <thead>
      <tr><th>#</th><th>Date</th><th>Branch</th><th>In</th><th>Out</th><th>Remarks</th></tr>
    </thead>
    <tbody id="dataBody"></tbody>
  </table>
</div>

<script>
/* ================= USERS (NO FETCH – FIXED) ================= */
const staffData = {
  "001": {Name:"Admin User", Mobile:"9876543210", Password:"admin123", Role:"ADMIN"},
  "002": {Name:"Staff User", Mobile:"9876543211", Password:"staff123", Role:"STAFF"}
};

const branchData = {
  "B001": {name:"Main Branch"},
  "B002": {name:"North Branch"}
};

let currentUser = null;
let workData = [];

/* ================= LOGIN ================= */
function login(){
  const mob = loginMobile.value.trim();
  const pass = loginPassword.value;
  loginMsg.textContent = "";

  for(let k in staffData){
    let u = staffData[k];
    if(u.Mobile === mob && u.Password === pass){
      currentUser = u;
      loginCard.classList.add("hidden");
      appCard.classList.remove("hidden");
      userInfo.textContent = `Welcome ${u.Name} (${u.Role})`;
      return;
    }
  }
  loginMsg.textContent = "Invalid login credentials";
}

/* ================= LOGOUT ================= */
function logout(){
  currentUser = null;
  appCard.classList.add("hidden");
  loginCard.classList.remove("hidden");
}

/* ================= BRANCH ================= */
function searchBranch(){
  let b = branchData[branchCode.value];
  branchName.value = b ? b.name : "";
}

/* ================= TIME ================= */
function to24(h,m,ap){
  h=parseInt(h); m=parseInt(m);
  if(ap==="PM" && h!==12) h+=12;
  if(ap==="AM" && h===12) h=0;
  return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
}

/* ================= SAVE ================= */
function save(){
  const rec = {
    date: workDate.value,
    branch: branchCode.value,
    in: to24(inHour.value,inMinute.value,inAmPm.value),
    out: to24(outHour.value,outMinute.value,outAmPm.value),
    rem: remarks.value
  };
  workData.push(rec);
  render();
}

/* ================= RENDER ================= */
function render(){
  dataBody.innerHTML="";
  workData.forEach((r,i)=>{
    dataBody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${r.date}</td>
        <td>${r.branch}</td>
        <td>${r.in}</td>
        <td>${r.out}</td>
        <td>${r.rem}</td>
      </tr>`;
  });
}
</script>

</body>
</html>
