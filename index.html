<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Work Master</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.card{max-width:400px;margin:auto;background:#fff;padding:20px;border-radius:8px}
input,select,button{width:100%;padding:10px;margin:6px 0}
button{background:#007bff;color:#fff;border:none}
.hidden{display:none}
.error{color:red;text-align:center}
.success{color:green;text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h3>Login</h3>
  <input id="loginMobile" placeholder="Mobile Number">
  <input id="loginPassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <div id="loginMsg" class="error"></div>
</div>

<!-- APP -->
<div class="card hidden" id="appCard">
  <h3>Attendance</h3>
  <div id="welcome"></div>

  <label>In Time</label>
  <input type="time" id="inTime">

  <select id="inMeridiem">
    <option>AM</option>
    <option>PM</option>
  </select>

  <label>Out Time</label>
  <input type="time" id="outTime">

  <select id="outMeridiem">
    <option>AM</option>
    <option>PM</option>
  </select>

  <button onclick="save()">Save</button>
  <div id="saveMsg" class="success"></div>
</div>

<script>
let staffData = {};
let currentUser = null;

/* LOAD JSON */
fetch("./staff_master.json")
.then(r => r.json())
.then(d => {
  staffData = d;
  console.log("Loaded staff:", staffData);
})
.catch(e => {
  alert("staff_master.json not loaded");
});

/* LOGIN */
function login(){
  const mobile = document.getElementById("loginMobile").value.trim();
  const pwd = document.getElementById("loginPassword").value.trim();
  const msg = document.getElementById("loginMsg");
  msg.textContent = "";

  let ok = false;

  for(let k in staffData){
    let u = staffData[k];

    if(u.Mobile === mobile && u.Password === pwd){
      ok = true;
      currentUser = u;

      document.getElementById("loginCard").classList.add("hidden");
      document.getElementById("appCard").classList.remove("hidden");
      document.getElementById("welcome").innerHTML =
        "Welcome <b>" + u.Name + "</b>";

      break;
    }
  }

  if(!ok){
    msg.textContent = "Invalid Login";
  }
}

/* SAVE */
function save(){
  const inT = document.getElementById("inTime").value;
  const inM = document.getElementById("inMeridiem").value;
  const outT = document.getElementById("outTime").value;
  const outM = document.getElementById("outMeridiem").value;

  if(!inT || !outT){
    alert("Select time");
    return;
  }

  const record = {
    user: currentUser.Name,
    inTime: inT + " " + inM,
    outTime: outT + " " + outM,
    date: new Date().toLocaleDateString()
  };

  localStorage.setItem("attendance", JSON.stringify(record));
  document.getElementById("saveMsg").textContent = "Saved Successfully";
}
</script>

</body>
</html>
