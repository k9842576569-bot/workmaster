<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Global Edge Work Master</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px;}
.box{max-width:460px;margin:auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px #999;}
input,button,textarea{width:100%;padding:10px;margin-top:10px;font-size:16px;}
button{background:#007bff;color:white;border:none;border-radius:5px;}
.hidden{display:none;}
.error{color:red;}
.success{color:green;}
h2{text-align:center;}
.role{text-align:center;font-weight:bold;color:green;}
textarea{height:120px;}
</style>
</head>

<body>

<!-- ========== LOGIN SCREEN ========== -->
<div class="box" id="loginBox">
<h2>Staff Login</h2>
<input type="tel" id="mobileInput" placeholder="Mobile Number">
<input type="password" id="passwordInput" placeholder="Password">
<button onclick="login()">Login</button>
<p id="loginError" class="error"></p>
</div>

<!-- ========== WORK MASTER SCREEN ========== -->
<div class="box hidden" id="workMasterBox">
<h2>Work Master Entry</h2>
<p id="staffName"></p>
<p id="staffRole" class="role"></p>

<!-- Branch Search -->
<input id="branchCode" placeholder="Enter Branch Code" onblur="searchBranch()">
<input id="branchName" placeholder="Branch Name" readonly>

<!-- Hidden Fields -->
<input id="district" type="hidden">
<input id="pincode" type="hidden">

<!-- Time -->
<label>In Time</label>
<input type="time" id="inTime">

<label>Out Time</label>
<input type="time" id="outTime">

<!-- Remarks -->
<textarea id="remarks" placeholder="Enter Remarks (Long Text Allowed)"></textarea>

<button onclick="saveEntry()">Save Entry</button>
<button id="excelBtn" onclick="exportExcel()">Export Excel</button>
<button onclick="openChangePassword()">Change Password</button>
<button onclick="logout()" style="background:red;">Logout</button>

<p id="msg"></p>
</div>

<!-- ========== CHANGE PASSWORD ========== -->
<div class="box hidden" id="changePassBox">
<h2>Change Password</h2>
<input type="password" id="oldPass" placeholder="Old Password">
<input type="password" id="newPass" placeholder="New Password">
<input type="password" id="confirmPass" placeholder="Confirm New Password">
<button onclick="changePassword()">Update</button>
<button onclick="back()">Back</button>
<p id="passMsg" class="error"></p>
</div>

<script>
let staffData = {};
let branchData = {};
let currentUser = null;

/* LOAD STAFF */
fetch("staff_master.json").then(r=>r.json()).then(d=>staffData=d);

/* LOAD BRANCH */
fetch("branch_master.json").then(r=>r.json()).then(d=>branchData=d);

/* LOGIN */
function login(){
  let mob = mobileInput.value.trim();
  let pass = passwordInput.value.trim();
  loginError.innerText = "";

  for(let k in staffData){
    let u = staffData[k];
    if(u.Mobile === mob && u.Password === pass){
      currentUser = u;
      loginBox.classList.add("hidden");
      workMasterBox.classList.remove("hidden");
      staffName.innerText = "Name: " + u.Name;
      staffRole.innerText = "Role: " + u.Role;
      excelBtn.style.display = (u.Role==="ADMIN") ? "block":"none";
      return;
    }
  }
  loginError.innerText = "Invalid Login";
}

/* BRANCH SEARCH */
function searchBranch(){
  let code = branchCode.value.trim();
  if(branchData[code]){
    branchName.value = branchData[code].BANCH_NAME;
    district.value = branchData[code].DISTRICT;
    pincode.value = branchData[code].PINCODE;
  }else{
    alert("Branch Code Not Found!");
    branchName.value="";
  }
}

/* SAVE ENTRY */
function saveEntry(){
  msg.innerText = "Entry Saved Successfully!";
  msg.className="success";
}

/* EXCEL (ADMIN ONLY) */
function exportExcel(){
  alert("Excel Export Allowed");
}

/* CHANGE PASSWORD */
function openChangePassword(){
  workMasterBox.classList.add("hidden");
  changePassBox.classList.remove("hidden");
}

/* UPDATE PASSWORD */
function changePassword(){
  let oldP = oldPass.value;
  let newP = newPass.value;
  let confP = confirmPass.value;

  if(currentUser.Password !== oldP){
    passMsg.innerText="Old Password Wrong";
    return;
  }

  if(newP !== confP){
    passMsg.innerText="Passwords Not Match";
    return;
  }

  currentUser.Password = newP;
  passMsg.className="success";
  passMsg.innerText="Password Updated (Session)";
}

/* BACK */
function back(){
  changePassBox.classList.add("hidden");
  workMasterBox.classList.remove("hidden");
}

/* LOGOUT */
function logout(){
  location.reload();
}
</script>

</body>
</html>
