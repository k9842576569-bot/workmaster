<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Global Edge Work Master</title>

<style>
body { font-family: Arial; padding:12px; background:#f4f4f4; }
.box { max-width:1000px; margin:auto; padding:16px; background:#fff; border-radius:8px; }
input, select, textarea, button { width:100%; padding:6px; margin:4px 0; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { border:1px solid #ccc; padding:6px; text-align:left; vertical-align:top; }
th { background:#eee; }
.btn-edit { background:orange; color:#fff; }
.btn-delete { background:red; color:#fff; }
.btn-export { background:green; color:#fff; margin-top:10px; }
.row { display:flex; gap:8px; flex-wrap:wrap; }
.col { flex:1; }
.time-row { display:flex; gap:4px; align-items:center; }
td { white-space:pre-wrap; word-break:break-word; }
</style>
</head>

<body>
<div class="box">
<h2>Global Edge Work Master</h2>

<!-- Branch -->
<div class="row">
  <div class="col"><input id="branchCode" placeholder="Branch Code"></div>
  <div class="col"><button onclick="fillBranch()">Search</button></div>
  <div class="col"><input id="branchName" placeholder="Branch Name" readonly></div>
</div>

<!-- Hidden District & Pincode -->
<input id="district" style="display:none">
<input id="pincode" style="display:none">

<!-- ✅✅✅ TIME 1–12 + AM PM (NO JS) -->
<div class="row">

<div class="col time-row">
<b>In:</b>
<select id="inHour">
<option>1</option><option>2</option><option>3</option><option>4</option>
<option>5</option><option>6</option><option>7</option><option>8</option>
<option>9</option><option>10</option><option>11</option><option>12</option>
</select> :

<select id="inMinute">
<option>00</option><option>01</option><option>02</option><option>03</option><option>04</option>
<option>05</option><option>06</option><option>07</option><option>08</option><option>09</option>
<option>10</option><option>15</option><option>20</option><option>25</option><option>30</option>
<option>35</option><option>40</option><option>45</option><option>50</option><option>55</option>
</select>

<select id="inAMPM">
<option>AM</option><option>PM</option>
</select>
</div>

<div class="col time-row">
<b>Out:</b>
<select id="outHour">
<option>1</option><option>2</option><option>3</option><option>4</option>
<option>5</option><option>6</option><option>7</option><option>8</option>
<option>9</option><option>10</option><option>11</option><option>12</option>
</select> :

<select id="outMinute">
<option>00</option><option>01</option><option>02</option><option>03</option><option>04</option>
<option>05</option><option>06</option><option>07</option><option>08</option><option>09</option>
<option>10</option><option>15</option><option>20</option><option>25</option><option>30</option>
<option>35</option><option>40</option><option>45</option><option>50</option><option>55</option>
</select>

<select id="outAMPM">
<option>AM</option><option>PM</option>
</select>
</div>

</div>

<textarea id="remarks" rows="4" placeholder="Remarks (Long text supported)"></textarea>

<button onclick="addData()">Add / Update</button>
<button class="btn-export" onclick="exportExcel()">Export to Excel</button>

<table id="table">
<thead>
<tr>
<th>ID</th><th>Branch Code</th><th>Branch Name</th>
<th>District</th><th>Pincode</th>
<th>In</th><th>Out</th>
<th>Remarks</th><th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
let branchMaster = {};
fetch("branch_master.json").then(r=>r.json()).then(d=>branchMaster=d);

function fillBranch(){
  let b = branchMaster[branchCode.value.trim()];
  if(!b){ alert("Branch Code Not Found!"); return; }
  branchName.value = b.BANCH_NAME;
  district.value = b.DISTRICT;
  pincode.value = b.PINCODE;
}

let data = JSON.parse(localStorage.getItem("work")) || [];
let edit=-1;

function addData(){
  if(!branchCode.value||!branchName.value){ alert("Enter Branch"); return; }

  let inTime = inHour.value+":"+inMinute.value+" "+inAMPM.value;
  let outTime = outHour.value+":"+outMinute.value+" "+outAMPM.value;
  let id = edit>=0 ? data[edit].id : data.length+1;

  let rec = {
    id, branchCode:branchCode.value, branchName:branchName.value,
    district:district.value, pincode:pincode.value,
    inTime, outTime, remarks:remarks.value
  };

  if(edit>=0){ data[edit]=rec; edit=-1; }
  else data.push(rec);

  localStorage.setItem("work",JSON.stringify(data));
  render(); clear();
}

function render(){
  let tb=document.querySelector("#table tbody");
  tb.innerHTML="";
  data.forEach((r,i)=>{
    tb.innerHTML+=`<tr>
<td>${r.id}</td><td>${r.branchCode}</td><td>${r.branchName}</td>
<td>${r.district}</td><td>${r.pincode}</td>
<td>${r.inTime}</td><td>${r.outTime}</td>
<td>${r.remarks}</td>
<td>
<button class="btn-edit" onclick="editRow(${i})">Edit</button>
<button class="btn-delete" onclick="delRow(${i})">Del</button>
</td></tr>`;
  });
}

function editRow(i){
  let r=data[i];
  branchCode.value=r.branchCode; fillBranch();
  let a=r.inTime.split(/[: ]/);
  inHour.value=a[0]; inMinute.value=a[1]; inAMPM.value=a[2];
  let b=r.outTime.split(/[: ]/);
  outHour.value=b[0]; outMinute.value=b[1]; outAMPM.value=b[2];
  remarks.value=r.remarks; edit=i;
}

function delRow(i){
  if(confirm("Delete?")){
    data.splice(i,1);
    localStorage.setItem("work",JSON.stringify(data));
    render();
  }
}

function clear(){
  branchCode.value=""; branchName.value=""; remarks.value="";
}

function exportExcel(){
  let csv=["ID,BranchCode,BranchName,District,Pincode,In,Out,Remarks"];
  data.forEach(r=>{
    csv.push(`${r.id},${r.branchCode},${r.branchName},${r.district},${r.pincode},${r.inTime},${r.outTime},"${r.remarks}"`);
  });
  let blob=new Blob([csv.join("\n")],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="workmaster.csv"; a.click();
}

render();
</script>
</body>
</html>
