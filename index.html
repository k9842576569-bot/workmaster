<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Global Edge Work Master</title>
<style>
  body { font-family: Arial; padding:12px; background:#f4f4f4; }
  .box { max-width:900px; margin:auto; padding:16px; background:#fff; border-radius:8px; }
  input, button { padding:6px; margin:4px 0; }
  table { width: 100%; border-collapse: collapse; margin-top: 16px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  .btn { padding: 4px 8px; cursor:pointer; margin:0 2px; }
  .btn-edit { background: orange; color: white; }
  .btn-delete { background: red; color: white; }
  .btn-export { background: green; color: white; margin-top: 10px; }
  input[type="text"], input[type="date"], input[type="number"] { width: 100%; box-sizing: border-box; }
</style>
</head>
<body>

<div class="box">
  <h2>Global Edge Work Master</h2>

  <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px;">
    <input type="text" id="entryID" placeholder="Entry ID">
    <input type="text" id="mobile" placeholder="Mobile">
    <input type="date" id="date" placeholder="Date">
    <input type="text" id="branchCode" placeholder="Branch Code">
    <input type="text" id="branchName" placeholder="Branch Name">
    <input type="text" id="inTime" placeholder="In">
    <input type="text" id="outTime" placeholder="Out">
    <input type="text" id="remarks" placeholder="Remarks">
  </div>

  <button onclick="addData()">Add / Update</button>
  <button class="btn-export" onclick="exportTableToExcel('dataTable', 'WorkMaster')">Export to Excel</button>

  <table id="dataTable">
    <thead>
      <tr>
        <th>EntryID</th>
        <th>Mobile</th>
        <th>Date</th>
        <th>Branch Code</th>
        <th>Branch Name</th>
        <th>In</th>
        <th>Out</th>
        <th>Remarks</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
let data = JSON.parse(localStorage.getItem('workData')) || [];
let editIndex = -1;

function renderTable() {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = '';
  data.forEach((item, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.entryID}</td>
      <td>${item.mobile}</td>
      <td>${item.date}</td>
      <td>${item.branchCode}</td>
      <td>${item.branchName}</td>
      <td>${item.inTime}</td>
      <td>${item.outTime}</td>
      <td>${item.remarks}</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(${index})">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(${index})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function addData() {
  const entryID = document.getElementById('entryID').value.trim();
  const mobile = document.getElementById('mobile').value.trim();
  const date = document.getElementById('date').value;
  const branchCode = document.getElementById('branchCode').value.trim();
  const branchName = document.getElementById('branchName').value.trim();
  const inTime = document.getElementById('inTime').value.trim();
  const outTime = document.getElementById('outTime').value.trim();
  const remarks = document.getElementById('remarks').value.trim();

  if(!entryID || !mobile || !date || !branchCode || !branchName) {
    alert('Please fill all required fields (EntryID, Mobile, Date, Branch Code, Branch Name)');
    return;
  }

  const record = { entryID, mobile, date, branchCode, branchName, inTime, outTime, remarks };

  if(editIndex >= 0) {
    data[editIndex] = record;
    editIndex = -1;
  } else {
    data.push(record);
  }

  localStorage.setItem('workData', JSON.stringify(data));
  clearForm();
  renderTable();
}

function editRow(index) {
  const item = data[index];
  document.getElementById('entryID').value = item.entryID;
  document.getElementById('mobile').value = item.mobile;
  document.getElementById('date').value = item.date;
  document.getElementById('branchCode').value = item.branchCode;
  document.getElementById('branchName').value = item.branchName;
  document.getElementById('inTime').value = item.inTime;
  document.getElementById('outTime').value = item.outTime;
  document.getElementById('remarks').value = item.remarks;
  editIndex = index;
}

function deleteRow(index) {
  if(confirm('Are you sure you want to delete this record?')) {
    data.splice(index,1);
    localStorage.setItem('workData', JSON.stringify(data));
    renderTable();
  }
}

function clearForm() {
  document.getElementById('entryID').value = '';
  document.getElementById('mobile').value = '';
  document.getElementById('date').value = '';
  document.getElementById('branchCode').value = '';
  document.getElementById('branchName').value = '';
  document.getElementById('inTime').value = '';
  document.getElementById('outTime').value = '';
  document.getElementById('remarks').value = '';
}

function exportTableToExcel(tableID, filename = '') {
  const table = document.getElementById(tableID);
  const rows = Array.from(table.rows);
  let csv = rows.map(row => Array.from(row.cells)
      .slice(0,-1) // skip action column
      .map(cell => `"${cell.innerText}"`).join(",")).join("\n");

  const blob = new Blob([csv], { type: 'text/csv' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename ? filename + '.csv' : 'export.csv';
  link.click();
}

renderTable(); // render on page load
</script>
</body>
</html>
